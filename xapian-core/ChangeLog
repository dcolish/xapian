Tue Feb 27 18:40:33 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Fixes to remote matcher code to cope better with failure of
	  submatchers:
	  - Timeout for all submatches now correctly start at same time.

	* Added more extensive testing of above code, involving adding
	  new parameters to inmemory to cause abort()s at various stages of
	  the match.

	* Remove obselete (and unused) method
	  SocketServer::read_global_stats()

	* Errors are now generated from strings by using omerrortypes.h with
	  suitable #defines before including it.  Updated todo accordingly.

	* Extend scope of try{} clause in socketserver, so that
	  SocketServerFinished exception never escapes.

	* Default timeout in progserver increased to 30000.

	* Default timeout in tcpserver increased to 15000.

Mon Feb 26 23:51:23 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Split query generation into stages: make new query, add subqueries,
	  then finalise.  Add private methods to OmQuery reflecting this, and
	  convert constructors into template methods, allowing any iterator
	  to be used for constructing queries.  Removed reference to
	  <vector> from omquery.h

	* Add omqueryinternal.cc, containing implementation of query
	  internals. (surprise!)

	* OmQuery::Internal now has some helper functions to determine the
	  properties of each particular query.  These should be converted
	  into a lookup table, and the remaining hard-coded properties (for
	  AND_MAYBE, AND_NOT and FILTER) factored out.

	* window property removed from constructor.  This can now be set by a
	  separate call, to "OmQuery::set_window()"

	* Added a deleter_vector class, to store subquery pointers in a more
	  exception-safe way.

	* Represent undefined queries by the new OP_UNDEF operation, rather
	  than a dedicated flag - cleaned up some logic.

	* Some modifications to XOR handling: should now behave like OR and
	  AND - doesn't need to be binary.  (*untested*)

	* Fixes to serialisation code in socketcommon.cc to work with new
	  OmQuery::Internals - this should really be done in
	  OmQuery::Internal.

	* One tiny fix in tcpclient.cc - an &fdset was missed for exception
	  conditions in a select() call.

	* Testsuite modified and expanded to check changes to OmQuery.

Mon Feb 26 18:20:16 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Fixed some compiler warnings reported by James Aylett.

Mon Feb 26 14:27:09 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Avoid waiting for a timeout when closing a SocketClient.

Fri Feb 23 14:38:09 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Updated todo.xml

Thu Feb 22 18:14:41 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* OmRegexFilterNode has an output for non-matching strings as
	  well as matching.  "out" output renamed to "matching".

Thu Feb 22 16:56:33 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Fixed a bug in the fetch() bits: requesting documents at the
	  same time from different OmMSet instances could cause a
	  document to disappear from the cache at the wrong moment.

Thu Feb 22 15:39:49 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Updated todo.

Thu Feb 22 12:14:12 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Some small changes in quartz to improve exception safety and
	  error checking.

	* Remove unwanted OmExpandWeight::get_expand_k() method.

Wed Feb 21 19:02:44 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Overhauled the OmMSet::fetch() etc. methods.  Documents are
	  requested when fetch() is called, but are only fetched (all
	  at once) when the first get_document() is called.

Wed Feb 21 19:30:20 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Add an errorhandler member to MultiMatch, and remove it from
	  various calls which used to pass it about.

	* Add an EmptyMatch object, which always returns an emptypostlist.

	* Implement errorhandlers at start of query for initially down
	  nodes.  Improve test for errorhandlers to cover many more cases.

	* Add many debug messages to error handling code.

Wed Feb 21 14:33:50 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Use a deque<> directly instead of a queue, due to conflict
	  with Solaris headers.
	
	* Split the collect_doc loop into a seperate function

	* SocketClient should be more robust against request_doc() being
	  used without collect_doc().

Tue Feb 20 18:01:13 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* SocketClient implements a queue/cache system which means that
	  collect_doc() doesn't need to be called in the same order as
	  request_doc().

Mon Feb 19 15:43:49 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Converted btree code to use new/delete instead of [mc]alloc/free.

Mon Feb 19 13:52:23 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Added new test collapsekey2 designed to work with muscat36
	  databases, which have different key handling.  Added two new
	  categories of tests to cope with this.
	
	* Adjusted BackendManager's key generation, and updated
	  test_specialchars1() accordingly.

Fri Feb 16 17:26:59 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Implemented a test for keep-alives

	* Added "-tNNNN" option to omprogsrv to pass a timeout value in.

	* Added get_network_database() in apitest to set the timeout.

Fri Feb 16 16:13:47 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Incremented the remote protocol version, since a new message
	  type has been added.

Fri Feb 16 15:55:31 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Added an OmDatabase keep_alive() method to gently prod any
	  remote databases.  Applications can use it to avoid the remote
	  servers timing out between queries.  Not properly tested yet...

Thu Feb 15 19:05:24 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* The remote server now supports a seperate timeout used while
	  idle, rather than actually servicing a request from the client.
	  Options --idle-timeout and --active-timeout added to omtcpsrv,
	  and --timeout sets both timeouts.
	
	* Added a documentation comment or two.

Wed Feb 14 18:43:00 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* In Muscat3.6 backends, don't read the key from the keyfile unless
	  keyno is 0.

Tue Feb 13 13:57:34 GMT 2001 Andy MacFarlane <andym@omsee.com>

	* Added parameter expand_k in omsettings in order to change
	  value of weighting in expand process.

Tue Feb 13 13:25:45 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Network timeouts now apply to write() operations as well
	  as read().

	* SocketLineBuf::do_writeline() now correctly deals with EAGAIN.

	* SocketServer has new method writeline() which handles write
	  access to the OmLineBuf.

Mon Feb 12 12:35:41 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Make OmPositionListIterators and any other appropriate iterators
	  (postlist, termlist) have a default constructor allowing them to
	  be declared uninitialised.

Mon Feb 12 10:51:41 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Updated todo.xml

Thu Feb  8 17:59:44 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Moved omnodepad.h from include/om to indexer/indexgraph/

	* Updated todo.xml

Thu Feb  8 17:35:45 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Updated todo.xml

Thu Feb  8 17:00:02 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Quartz now has a metafile which for now has a magic string
	  and a version number.
	
	* sys_open_to_read() and delete_file() exported from btree.cc.
	  The latter was renamed to sys_unlink_if_exists().
	
	* Include btree_types.h from btree_util.h

Wed Feb  7 17:33:00 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Fix to InMemory databases: terms can be added even if they
	  don't have any positions.  (Was causing adddoc2 to fail).

Tue Feb  6 18:06:13 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Rename OmMSet::fetch_items() to fetch().  Add an overloaded
	  fetch() method taking a single iterator, to fetch a single item.

	* Fix some documentation comments.

Mon Feb  5 19:16:45 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Update TODO

Mon Feb  5 19:12:39 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Test behaviour of OmDocument methods add_term(), set_wdf(),
	  remove_posting() and remove_term().  Fails for inmemory databases.

Mon Feb  5 17:46:16 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Modified the behaviour of timeouts during a match.  Internally,
	  an absolute timeout time is set from start_match().  Now remote
	  nodes should timeout at NOW + remote_timeout, rather than
	  waiting remote_timeout milliseconds for each read().  Needs
	  some more testing.

Mon Feb  5 17:21:52 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix a missing #include in socketcommon.h

Mon Feb  5 17:15:46 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Sort generated todo lists.

Fri Feb  2 17:44:54 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Add an OmDocument::add_term() method.

	* Remove an unwanted check that wdf's are greater than 0: wdf of 0
	  _is_ allowed.

Fri Feb  2 15:04:08 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Hopefully, a fix for segfaults/assertions when network errors
	  happen halfway through a match, when handled by OmErrorHandler
	  objects: give the place-holder EmptyTermLists weighting objects.

Thu Feb  1 19:03:10 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Fixes to OmDocument interface: add parameters specifying the
	  changes to be made to the wdf to add_posting and remove_posting,
	  properly implement remove_posting and remove_term, including
	  throwing of exceptions, and add a set_wdf() method to set the wdf
	  to an absolute value.  Corresponding modifications to
	  OmDocumentTerm.

	* Fix commented out errorhandler code in multimatch.cc, so it still
	  compiles.

	* Add a check to avoid division by zero in bm25weight.cc

Thu Feb  1 15:59:30 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add a missed #include to omqueryinternal.h

Thu Feb  1 14:44:04 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Add some error handler code, with a "#if 0"ed out comment,
	  to multimatch.cc

Wed Jan 31 15:45:16 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Remote servers should close down more gracefully when the
	  client closes down in the middle of a request.

Tue Jan 30 16:52:05 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Removed unneeded #includes of STL headers from API headers.

	* All #includes of files which are not installed use "" rather than
	  <>.  This means all #includes of OM files except for those which
	  are in example programs (and hence might be compiled against the
	  installed library).  "" search paths are a superset of <> search
	  paths: hence this should ensure that the om headers work however
	  they are used.

	* Moved supplied OmExpandDecider subclasses into
	  include/om/omexpanddecider.h

	* Remove om_termname_list from API: not used except by code which
	  displays it, and in testsuite.

Tue Jan 30 12:45:22 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Removed #include <vector> from omstem.h

Tue Jan 30 11:09:29 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* OmStem::get_available_languages() now returns a string
	  rather than a vector.  Languages are space-separated.
	  Updated apitest.

	* Added definition of RTLD_DEFAULT to internaltest.cc

Mon Jan 29 16:11:15 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* OmIndexerMessage's copy-on-write slightly more careful.

	* Improved debugging in OmIndexerNode

	* Fixed a bug in the termlistadd node - it tried to append to a
	  non-vector.

Fri Jan 26 16:21:09 GMT 2001 Olly Betts

	* indexerxml.cc: Removed some dead code.

Fri Jan 26 16:11:13 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Added omindexerdescinternal.h to the Makefile

Fri Jan 26 15:50:32 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Move OmQuery definition into a separate header file.

Fri Jan 26 15:46:42 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Move OmQuery::OP_LEAF out of public visibility, by taking it out
	  of the enum, making it a static const member of OmQuery::Internal,
	  and introducing an OmQuery::Internal::op_t to store query
	  operators in internally.  We lose the ability for the compiler to
	  warn us if we forget to check for a particular operator in a
	  switch statement, but this can't really be avoided.

Fri Jan 26 13:49:33 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Added get_output_{node,pad} to OmIndexerDesc

	* Implemented and testes OmNodeInstanceIterator

	* Implemented OmIndexerBuilder::build_from_desc, which somehow
	  hadn't been.  indextest now uses it.

Thu Jan 25 18:47:08 GMT 2001 Olly Betts

	* Fixed various .cvsignore files (omus -> omsee, and
	  bindings/java/.cvsignore which seemed to have been copied from
	  the top level one at some point).

	* Fixed bug in OrPostList when used in a pure boolean context
	  (uninitialised variables).

	* tests/internaltest.cc: removed unused reference to getopt.h.

	* tests/stemtest.pl.in: removed lots of bogus semicolons after
	  closing braces.

Thu Jan 25 17:53:08 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Turn debugging messages (OM_DEBUG_TYPES) off by default.

	* Add todo items for release to pages generated for website.

Thu Jan 25 15:11:14 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Add a couple of documentation comments: we need many more of
	  these.  No method, and certainly no class, in the API should be
	  without an explanatory comment (not least so that they're
	  accessible from the doxygen browser).

Thu Jan 25 14:51:55 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Hide the internals of OmIndexerDesc, and adding member functions
	  to do all the necessary operations (not all yet implemented).
	
	* Indexer internals mostly deal with OmIndexerDesc::Internal

	* Removed '#include <vector>' from omindexerdesc.h

Thu Jan 25 13:45:49 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* When setting up an RSet, allow documents to be referenced by
	  OmMSetIterator, for convenience.

	* Allow OmMSetIterators and OmESetIterators to be created without
	  initialising, also for convenience.

	* Include CFLAGS for STLPORT in the flags produced by omsee-config.

	* Change several more missed "omus"s to omsee.

Thu Jan 25 13:50:06 GMT 2001 Chris Emerson <chris.emerson@omsee.com>

	* Changed a mention of libomus in netprogs/Makefile.am to libomsee

Thu Jan 25 12:33:46 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Build only the API docs when making dist / install.  Full source
	  docs only get built if explicitly asked for.

Thu Jan 25 11:36:39 GMT 2001  Richard Boulton <richard.boulton@omsee.com>

	* Project name changed to Omsee.

	  Ramifications from a technical viewpoint are:

	  - library name changed from libomus.* to libomsee.*
	  - libomus-config renamed to omsee-config
	  - Autoconf macro file libomus.m4 renamed to omsee.m4,
	    macro name OM_PATH_LIBOMUS changed to OM_PATH_OMSEE
	    and macro now defines OMSEE_CFLAGS and OMSEE_LIBS rather
	    than LIBOMUS_CFLAGS and LIBOMUS_LIBS.  configure arguments
	    changed name, also.

Wed Jan 24 15:57:10 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Improve test of OmMSetIterators equality comparisions.

	* Update TODO

Wed Jan 24 15:11:11 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Renamed OmNodeConnection to OmNodePad.  The old name was
	  confusing.
	
	* Added OmPadIterator, and OmNodeDescriptor::{in,out}puts_{begin,end}.
	  Also implemented OmNodeDescriptor::get_type()

	* Added output function for OmPadIterator

	* Added test for OmPadIterators

Tue Jan 23 19:01:29 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Remove OmBatchEnquire from system: it may return at a later date,
	  but for now it is simply out of date and a maintainance liability,
	  and gives no significant advantage.  Code now exists in
	  ombatchenquire.h in CVS, but is not part of build process.

	* Make OmEnquire and OmMSet have reference counted internals: this
	  introduces a further layer of indirection, but tidies up things
	  greatly.

	* Remove get_docs() and get_doc() methods from OmEnquire.
	  get_doc(docid) is catered for by OmDatabase::get_document(docid).
	  Added OmMSetIterator::get_document() to replace get_doc on a 
	  MSetIterator.  Added OmMSet::fetch_items() to replace get_docs():
	  it prefetches the documents (or just those specified by some
	  MSetIterators into a cache in the Mset).

	* OmMSet internals now have a reference to the creating OmEnquire
	  object: this is set up after the mset returns from the matcher.
	  If the reference is null, the Mset was created standalone, and 
	  get_doc methods will fail.

	* OmMSetIterators now have a reference to the MSet, instead of a
	  percent_factor stored.  This allows the percent_factor to be
	  lazily calculated, and also allows get_doc to work.

	* Add get_rank() method to OmMSetIterators.

	* Improve introspection on OmDocument, and fix a bug with assignment
	  of OmDocument (wasn't assigning most of the internals).

	* Add a missing std:: on a string in omstopwordnode.

	* Fixed several documentation comments.

	* Add some more debugging to quartz.

	* Update TODO.

	* Add test_fetchdocs1 to apitest.  Disable test_batchquery1.

	* Remove sign comparison error in VectorTermList.

Tue Jan 23 16:24:04 GMT 2001 Olly Betts

	* No longer compile with -ansi under gcc - it causes problems by
	  preventing Linux system headers defining various functions we need.

	* testsuite/testsuite.cc: when reporting exceptions, display
	  exception's errno value if set.

Tue Jan 23 15:13:58 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Killed OmIndexerBuilder::NodeType.  Now use OmNodeDescriptor
	  in its place, getting rid of another vector usage in the API.
	
	* OmNodeDescriptor adjusted for its new role: internals are
	  refcounted, and some query as well as setting functions.

	* Cast the fourth argument to getsockopt() to void *.  On Solaris
	  that argument is char *.

Tue Jan 23 11:24:13 GMT 2001 Olly Betts

	* Tiny tweak to da_document.cc.

Fri Jan 19 18:36:15 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Removed get/set vector methods from OmSettings

	* Remote/prog arguments now passed in a string separated be spaces,
	  not a vector.
	
	* split_words() moved from netutils.h to utils.{h,cc}

	* Some unnecessary #include <vector> lines removed from API headers

	* Removed get_config_vector() from OmIndexerNode

	* OmConstantNode no longer handles vector values, and
	  OmStopWordNode and OmSelectItemsNode use space-separated
	  values instead.

Thu Jan 18 17:31:55 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Removed mentions of std::vector from OmIndexerMessage, and
	  updated the relevant bits.

	* Fixed a bug with the copy-on-write parts of OmIndexerMessage.

Thu Jan 18 17:09:43 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix to btreetest.cc: shouldn't fail if test data files are not
	  available.

	* Fix to multimatch.cc: clamp hits values to number of documents
	  matched after collapsing and match functors, rather than before.

Thu Jan 18 14:13:21 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix error messages thrown by quartz when a database doesn't exist /
	  already exists and isn't to be overwritten.

	* Make quartz clean up an old database directory, if
	  database_allow_overwrite is specified, so that old base files don't
	  confuse things.

Wed Jan 17 18:18:50 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Added all used toplevel directories to DIST_SUBDIRS

Wed Jan 17 18:13:50 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Martin committed changes to btree.cc which should fix some random
	  problems experienced with quartz.

	* Added in a test framework for the btree code, which exhibited the
	  bug fixed by martin until updating to his fixed version.

Wed Jan 17 16:10:02 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Moved the socklen_t definition so that tcpclient.cc could see
	  it.

Tue Jan 16 20:35:18 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix creation of quartz databases in backendmanager: all tests should
	  now pass.

Tue Jan 16 20:28:46 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix quartztest so that the tables / databases get created.
	  Implement new test "create1" to check that creation of databases
	  works as specified.

	* Fix test for whether we are allowed to overwrite a database.

	* Implement much better logging from quartz when making new databases.

	* Clean up an error message from btree.cc

Tue Jan 16 19:24:49 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Don't display messages about allocation failures in the first
	  iteration: if the failures go away when repeating, we're not
	  interested.

Tue Jan 16 18:28:03 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add two new OmSettings, for use when opening databases:
	  database_create and database_allow_overwrite.  The idea is that
	  databases will only be created if database_create is specified,
	  and that when they are being created an exception will be thrown
	  if there's an existing database unless database_allow_overwrite
	  is specified.

	* Implemented database_create and database_allow_overwrite for
	  Quartz, which is the only relevant type for now.  Note that this
	  breaks the testsuite, quite badly.

	* Add OmDatabaseCreateError, which is thrown when creating a database
	  fails.

Tue Jan 16 17:08:47 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed a typo in -ldl detection

Tue Jan 16 15:15:30 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Remove OmNeedRecoveryError, and quartz's quartz_perform_recovery
	  parameter.  Quartz now always performs recovery if needed: there
	  is no need for this added complication.

	* Update TODO

Tue Jan 16 14:25:03 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Changed references to SIGCLD to SIGCHLD as it's more portable.

Tue Jan 16 14:02:34 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Added check for whether -ldl is necessary.

Tue Jan 16 11:51:25 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Added compatibility bits for early libxml1 versions.

Mon Jan 15 18:18:01 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Removed use of hstrerror, which isn't portable.

Mon Jan 15 18:02:42 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix assertion which was the wrong way round in multimatch.cc

Mon Jan 15 17:46:13 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix initialisation of Btree_base::sequential when creating database.

Mon Jan 15 15:43:46 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Renamed some uses of XML node structure for libxml2 compatibility.

Mon Jan 15 15:35:50 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add some fixes to sequential access to btrees from Martin.

Mon Jan 15 12:23:02 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Set matches_* to the known value of the number of hits if we have
	  been unable to return as many hits as were requested, and therefore
	  know the exact number.

	* Update test_matches1() to check this works correctly.  Passes.

Fri Jan 12 17:45:27 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Implement get_doclength() for QuartzDatabase

	* Remove unused parameter from QuartzRecordManager::add_record()

Fri Jan 12 17:14:16 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed MultiAllTermsList, which had stopped working.

Fri Jan 12 15:32:34 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add test to apitest (postlist6) that doclengths got from postlists
	  are the same as those from databases.  Fails for Quartz for the
	  moment.

	* Add test to quartztest (disktable3) to try and bring out a bug in
	  adding to tables.

Fri Jan 12 15:20:09 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix STLport macro so that it will accept an STLport installation
	  with foo/include/stlport and foo/lib instead of foo/stlport and
	  foo/lib.

Fri Jan 12 14:04:37 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed buglet in configure.in which produced a bogus warning
	  about regex libraries.
	
	* Added an AC_MSG_RESULT corresponding to an AC_MSG_CHECKING
	  for the libxml flags

Fri Jan 12 13:18:07 GMT 2001 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed skip_to() in QuartzAllTermsList

Fri Jan 12 12:52:57 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Turn debugging off in btree.cc: accidentally committed a version
	  with lots of verbose debugging on.

Fri Jan 12 11:16:17 GMT 2001 Olly Betts

	* glibc 2.2 needs `#define _GNU_SOURCE' to give us RTLD_NEXT.

	* C++ comments changed to C comments in malloccheck.c.

Thu Jan 11 16:42:07 GMT 2001 Olly Betts

	* Removed unnecessary `#include "alltermslist.h"' from
	  d[ab]_database.h.

Wed Jan 10 14:28:10 GMT 2001 Olly Betts

	* Updated various .cvsignore files.

Tue Jan 09 19:03:12 GMT 2001 Olly Betts

	* Tidied up dead code from OmAllTermIterator.
 
Tue Jan 09 18:41:21 GMT 2001 Olly Betts

	* OmAllTermsIterator merged into OmTermIterator.

	* When iterating over all terms, skip_to() doesn't set at_end()
	  when it skips off the end.  Fixed except for quartz and added
	  regression test (allterms3).
 
Tue Jan  9 18:14:04 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add some extra debugging code into btree code in quartz.

Tue Jan  9 17:22:12 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Make skip_to() work (ie, do nothing) on OmTermIterators, when the
	  term iterator is at_end() already.

Tue Jan  9 13:32:08 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Updates to make the quartzdump utility more useful.

	* Added new test to test cursor behaviour in quartz.

Tue Jan  9 11:31:26 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Remove an item from TODO

Tue Jan  9 10:27:35 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add a missing \ in tests/Makefile.am

Mon Jan  8 19:03:42 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Increment format number in quartz/btree_base.cc.  This isn't
	  actually due to a change in the btree format, but to ensure that
	  some databases which were causing problems are rebuilt.

	  We need to add quartz format numbers, separate from the btree format
	  numbers, to check this kind of thing.

Mon Jan  8 15:13:04 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add some debugging, and fix a test data file.

Mon Jan  8 13:49:50 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix failure to initialise OmMSet::Internal::have_percent_factor.

Thu Jan  4 17:21:24 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add new test for a postlist with many documents, designed to fail
	  and exhibit the bug andy has found.  So far doesn't fail.

Wed Jan  3 19:30:30 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Add get_percent method to OmMSetIterator.  Untested.

	* Add om_percent type to om_types.

	* Add test of sort order of terms in get_matching_terms.

Tue Jan  2 15:05:53 GMT 2001  Richard Boulton <richard.boulton@open.muscat.com>

	* Move documentation of parameters for OmSettings out of omsettings.h
	  and into docs/.  Not in distribution at the moment: it is awaiting
	  placement into a permanent home (I think the user manual is the
	  correct place).

	* Add a bm25weight_min_normlen parameter: this specifies a cutoff
	  on the minimum value that can be used for a normalised document
	  length: smaller values will be forced up to this cutoff.  This
	  prevents very small documents getting a huge bonus weight.

Wed Dec 20 16:54:41 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix warning in QuartzTable

Wed Dec 20 15:13:05 GMT 2000 Olly Betts

	* OmTermListIterator merged into OmTermIterator.

	* Added OmRSet::contains() - checks if an RSet contains a given
	  docid.

	* Methods returning `const om_termname' now just return
	  `om_termname'.

Tue Dec 19 16:55:02 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Implemented AllTermsIterator for DA and Multi databases.
	  Added a test which actually uses a multidatabase, but
	  disabled it as it currently fails for both Quartz and DA.

Tue Dec 19 12:14:05 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Adjusted TODO

Tue Dec 19 20:06:43 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Escaping for termnames in remote database communication modified
	  to use only characters in range 33 to 126.  Should now work on all
	  architectures.

	* Increased OM_SOCKET_PROTOCOL_VERSION to 8.

Mon Dec 18 17:23:48 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added "match_cutoff" option to get_mset OmSettings.

	* Added test for "match_cutoff" to apitest.

	* Updated todo.xml

Mon Dec 18 17:19:40 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Implemented opening positionlists from inmemory databases.  Added
	  a testcase as well, which is run for quartz and inmemory.

Mon Dec 18 15:48:16 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Implemented AllTermsIterator for quartz.  Interaction with
	  QuartzPostList needs to be cleaned up.

	* Added new functions [un]pack_string_preserving_sort(), which
	  pack a string in a way which preserves sort order.  Added a
	  testcase to quartztest.

	* Now use [un]pack_string_preserving_order() on postlist keys, so
	  that we can get at terms in sorted order.  (And get_tname_from_key()
	  added to separate out the term-unpacking as well as the packing)
	
	* Enabled test_allterms1 in apitest, but put it in a group of
	  tests only run for inmemory and quartz.  This should be extended
	  to other backends.

Mon Dec 18 14:33:42 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Implemented tests of msetiterator and esetiterator copying and
	  assignment.

	* Fix segfault when assigning to [me]setiterator to end.

	* Updated todo.xml

Mon Dec 18 13:52:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Move creation of first key in a quartz postlist into a named
	  function (was scattered through the code).

Mon Dec 18 11:19:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Update todo.xml

Mon Dec 18 10:47:42 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Remove const from reverse_iterators in api_db.cc, so get around
	  brokenness of egcs 1.1.2

Mon Dec 18 09:41:54 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added apitest_space.txt to the Makefile.am

Sun Dec 17 16:15:03 GMT 2000 Olly Betts

	* Replaced all API uses of om_termname_list with OmTermIterator.

Fri Dec 15 18:54:10 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Implemented OmAllTermsIterator interface in API.  It works for
	  inmemory - the rest haven't been implemented yet.  The test
	  is commented out.

Fri Dec 15 15:47:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Updated TODO.

	* database returns positionlists as AutoPtrs; this neatens some of
	  the code from the previous changelog entry, and makes explicit the
	  ownership of the pointer.  postlists and termlists should be
	  AutoPtrs, likewise.

Fri Dec 15 14:59:41 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Make OmPositionListIterators retrieved from OmPostListIterators
	  valid indefinitely (were only valid until OmPostListIterator was
	  moved).  This makes them consistent with OmPositionListIterators
	  retrieved from OmDatabases.
	  
	* Renamed PostList::get_position_list() to read_position_list.
	  Added PostList::open_position_list() which opens a new positionlist
	  and returns it as an AutoPtr.

Fri Dec 15 13:09:51 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Make TODO.release file, containing TODO items for next release.

Fri Dec 15 12:06:42 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* QuartzDatabases now autoflush after 1000 changes.

Fri Dec 15 11:40:37 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix segfault in quartz_table

Fri Dec 15 11:23:15 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Removed begin/end_session() from quartztest

Thu Dec 14 19:19:40 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Done todo item: For writable databases, make the behaviour currently
	  obtained by calling begin_session() and later end_session() the
	  default behaviour.  If users want the changes to be applied
	  immediately following a change, they should call flush().

Thu Dec 14 17:48:27 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix problem with recalc_maxweight() not being called before a
	  get_maxweight() in multimatch.cc if a node prunes at the top level,
	  since recalculate_w_max wasn't being checked at this point.
	  Introduced helper function getorrecalc_maxweight() to tidy this up.

	* Tidy up Asserts in common/netutils.h.

Thu Dec 14 17:11:17 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Adjusted todo.xml

Thu Dec 14 16:21:27 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Removed handling of OmDatabaseModifiedError in the API - it's
	  up to the users to know what to do.  Disabled quartzoverwrite2
	  as it's now inappropriate.
	
	* Added OmDatabase::reopen() to help them do so.

	* Adjusted todo.xml

Thu Dec 14 14:38:39 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added another quoting regression test.

Thu Dec 14 14:36:53 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed the quoting _again_, since it broke with backslashes.

Thu Dec 14 12:49:58 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix problems with recalculation of maxweight in postlists, causing
	  AssertParanoid at multimatch.cc:393.  When a prune was happening,
	  recalc_maxweight flag was not always being set, because some
	  {next,skip_to}_handling_prune() methods weren't being passed the
	  matcher, and a default argument of 0 was being used.  I've now
	  removed the default argument and pass the matcher always.

	  Sometimes the recalc could perhaps be avoided, but this is
	  certainly safer for now.

Thu Dec 14 12:30:02 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Sleepcat is now disabled by default.

	* Fixed a problem with tabs not being quoted in the remote case.  All
	  control characters are now quoted.  Incremented the protocol ver
	  number.

Thu Dec 14 11:54:17 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added regression test to check that all characters can be
	  are safe to exist in document keys.

	* Fixed OmDebug so that it can display messages containing zero bytes
	  (use fwrite instead for fprintf)

Wed Dec 13 18:43:40 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add regression tests to apitest to check that OmMSet and OmESet
	  begin() and end() iterators compare equal if the mset is empty.
	  Fix matchfunctor used in test_matchfunctor1 so that it works for
	  Muscat3.6 databases.

Wed Dec 13 18:35:05 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed bugs in OmMSet and OmESet iterators: begin() when the set
	  was empty produced an invalid iterator, and the assignment
	  operators would have failed when end iterators were involved.

	* Added a check in test_matchfunctor1() that the mset returned is
	  not empty.

Wed Dec 13 18:18:09 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Turn off tests involving terms with newlines or zero bytes in terms
	  with Muscat3.6 backends; these can't be expected to work.

Wed Dec 13 18:06:29 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Uncommented the code in pctcutoff1 - test now passes.

Wed Dec 13 17:53:19 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix: m36_key_file parameter wasn't being set with DA flimsy
	  databases (thanks to Mark Hagger).

	* indextest.cc changed to use "\n" instead of endl - compiles
	  with STLport again.

Wed Dec 13 17:27:17 GMT 2000 Olly Betts

	* OmMSet is now an STL compatible container.

	* Om*Iterator::difference_type was unsigned - now signed.
	
	* net/readquery.ll: fixed compiler warning.
	
	* Remote backend was defaulting to collapse on key 0.
	
Wed Dec 13 16:48:49 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Add handling of DatabaseModified to OmEnquire::get_mset()

Wed Dec 13 16:28:47 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Escape zero bytes in the network protocol, since these were
	  breaking things when being passed across as part of keys.

	* Add test of having zero bytes in the collapse keys.

	* In testsuite, only display the context of errors if there is one
	  present.

Wed Dec 13 14:44:46 GMT 2000 Olly Betts

	* Implemented OmMSet::operator[]().

Wed Dec 13 14:30:57 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added support for handling overwritten database conditions.
	  Currently works for OmDocument::get_{data,key}().

Wed Dec 13 13:20:45 GMT 2000 Olly Betts

	* Elaborated API hitlist in todo.xml.

Wed Dec 13 12:28:18 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fix to BackendManager to stop it removing tables prematurely.

Wed Dec 13 11:49:53 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Apply the stemmer to query terms used in spaceterms1.  (Not doing
	  so caused the test to fail spuriously on local databases, since the
	  terms are stemmed at index time).  The test still fails with da and
	  db databases.
	
	* Fixed a problem when stats were unpacked from the network stream,
	  where term names were not correctly unquoted.  This led to double
	  quoting of global statistics.

Wed Dec 13 02:49:05 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Implement copy and assignment methods for OmPositionListIterator.

Wed Dec 13 02:37:14 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* ESet and MSet iterators now cope with being copied / assigned when
	  the internals are null.

	* Added copy method to OmPositionListIterator interface.  No
	  implementation for this yet though, or for the already existing
	  assignment method.

	* Added a couple of easy items to the todo list to check regarding
	  iterators.

Wed Dec 13 02:19:50 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix small bug in mset_range_is_same{,_weights}()

Wed Dec 13 02:07:59 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* And add copy and assignment for OmESet, similarly.

Wed Dec 13 01:58:38 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add copy and assignment operators to OmMSet so that the internals
	  get copied (rather than just the pointer to them).  Really want a
	  small internals class, holding a refcount to the real internals, or
	  else to use refcntptrs for the members of OmMSet::Internal which are
	  potentially large (eg, items)

Wed Dec 13 01:05:44 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add Asserts to api/omdatabaseinternal.cc to ensure that there is at
	  least one database present when opening termlists, etc.  This should
	  really be done by throwing errors.

	* Add destructor to OmMSet, deleting internals.

	* Implement getting positionlists from QuartzDatabases.

	* Fix bug in copy constructor of OmDocument::Internal - some fields
	  were not being copied.

	* Fix api_db.cc so it compiles: code referring to mset by subscripting
	  temporarily commented out.

Tue Dec 12 20:05:10 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix bug with truncation of intermediate keys in btrees.

Tue Dec 12 18:33:12 GMT 2000 Olly Betts

	* OmMSet::get_docs() now takes sane parameters.

	* Various test programs updated to nearly work with new OmMSet
	  interface.

Tue Dec 12 17:18:33 GMT 2000 Olly Betts

	* Finished cleaning up OmMSet; updated TODO to reflect this.

Tue Dec 12 17:16:02 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix bug with sorting keys in btrees.

	* Various fixes to quartzdump.

Tue Dec 12 15:40:28 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Nettest compiles with new OmMSet interface.

Tue Dec 12 15:09:14 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed an endless loop in QuartzWritableDatabase::do_delete_document.

Tue Dec 12 15:07:39 GMT 2000 Olly Betts

	* OmMSetItem replaced by OmMSetIterator.

	* Added OmESet::empty().

	* Fixed == on OmESetIterator.

Tue Dec 12 14:16:57 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Renamed arguments to compare_keys()

Tue Dec 12 12:05:24 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added quartzdump utility to dump the contents of a quartz table.

Tue Dec 12 10:54:44 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added constructors and destructor to OmRSet.

Mon Dec 11 16:32:07 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Remove caching of average length in OmDatabaseInternal, was breaking
	  asking for the average length of a database which was being
	  modified.

Mon Dec 11 16:03:46 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* If no documents in database, don't divide by zero in
	  omdatabaseinternal.cc

	* If a document object doesn't come from the database, when iterating
	  through its termlist don't open postlists from the nonexistant
	  database; open them from the DocumentTerm objects in the document
	  instead.

	* Remove old unused and undefined method
	  OmDocument::Internal::add_posting()

Mon Dec 11 13:53:18 GMT 2000 Olly Betts

	* omenquire.h: Removed superfluous declaration of OmMSetCmp.

Mon Dec 11 13:38:12 GMT 2000 Olly Betts

	* Updated TODO list.

Mon Dec 11 13:24:45 GMT 2000 Olly Betts

	* OmRSet internals encapsulated.

Mon Dec 11 12:42:02 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* OmIndexerMessage::get_element and ...::operator[] now have
	  non-const versions.  Fixes const-warning in omstemmernode.cc.

Mon Dec 11 12:17:32 GMT 2000 Olly Betts

	* Better typedef-s for Om*Iterator::difference_type.

Sun Dec 10 17:51:41 GMT 2000 Olly Betts

	* Corrected various typedef-s for Om*Iterator.

Sun Dec 10 17:28:59 GMT 2000 Olly Betts

	* Updated TODO to reflect OmESet being cleaned up.

	* Term position argument to OmDocument::add_posting() is now
	  optional (as it was for OmDocumentContents).

Sun Dec 10 16:55:17 GMT 2000 Olly Betts

	* OmESetItem is dead - long live OmESetIterator!

	* net/socketclient.cc: fixed compiler warning.

	* net/socketserver.cc: fixed compiler warning.

Sun Dec 10 13:29:15 GMT 2000 Olly Betts

	* Started to encapsulate OmESet/OmESetItem interface.  Interface is
	  close, but currently implementation is exposed in omenquire.h.
	  
	* apitest wasn't running puncterms1 or spaceterms1 - fixed.
 
Sun Dec 10 11:34:39 GMT 2000 Olly Betts

	* om/autoptr.h -> autoptr.h in lots of places.

Fri Dec  8 17:20:04 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Updated indextest to not use AutoPtr<OmIndexer>

Fri Dec  8 17:14:09 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Oops - removed one too many #include "autoptr.h"

Fri Dec 08 16:50:42 GMT 2000 Olly Betts

	* Updated TODO.

Fri Dec  8 16:44:26 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* IndexerBuilder now returns OmIndexer objects instead of
	  AutoPtr<OmIndexer>.  OmIndexer's internals are reference
	  counted.
	
	* Moved autoptr.h from include/om to common/, since it's no
	  longer used in the API.

Fri Dec  8 16:22:48 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed omstemmer node bug and made debug slightly more verbose
	  in indextest.cc.

Fri Dec  8 16:13:36 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added a test for OmIndexerMessage to indextest

	* Added output operator for OmIndexerMessage

	* Fixed a bug introduced into omvectorsplit node

	* Changed couts in indextest.cc to touts.

Fri Dec 08 14:53:24 GMT 2000 Olly Betts

	* quartztest: removed OmDocumentTerm reference so that it'll
	  compile (tests fail though).

Fri Dec  8 14:42:46 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* OmIndexerMessage is now a class by itself, replacing OmIndexerData
	  and the typedef to AutoPtr<OmindexerData>.  It's now a copy-on-write
	  object.

	* The indexer stuff all changed.

Fri Dec 08 14:24:02 GMT 2000 Olly Betts

	* omindexdoc.{cc,h}: no longer used so removed.

	* Pushed OmDocumentTerm from API level into the internals of the
	  library.

	* Updated TODO.

Fri Dec 08 12:08:49 GMT 2000 Olly Betts

	* delve: if just given a database (or list of databases), report the
	  number of documents and average document length.

Thu Dec  7 20:39:24 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix bug: Om*Iterators which were created over empty lists didn't
	  have null internals, causing them not to compare equal to end
	  iterators.

	* Added many asserts to iterator code.

Thu Dec  7 20:02:43 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Removed OmTermListIteratorMap - OmTermListIterator can now be
	  across either a map or an actual termlist.

	* Om*Iterator classes all now delete internals when reaching end,
	  freeing resources sooner and making the comparison operators much
	  simpler.

Thu Dec  7 18:33:03 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Updates to TODO

Thu Dec  7 18:32:39 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Implementation of write locks for Quartz

Thu Dec  7 18:28:55 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fix to backendmanager which doesn't return writable databases
	  unnecessarily (which breaks things when there are write locks)

Thu Dec  7 18:25:50 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added test for Quartz write locks

Thu Dec  7 17:56:19 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add OmDocument::set_data() method which takes a string, instead of
	  an OmData object.  This allows, implicitly, use of const char *'s
	  as well.

	* Further fixes to quartztest.  It now compiles (though I've not
	  tried linking it yet...)  :)

Thu Dec  7 17:49:50 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed omkeylistiterator return types.

Thu Dec  7 17:27:57 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Moved get_document() from OmWritableDatabase to OmDatabase.

	* Added -> operator to OmKeyListIterator.  Fixed return values
	  and constness of Om*Iterator::operator *() methods.

	* Some fixes to quartztest.cc, but not enough to get it compiling.

Thu Dec 07 16:21:28 GMT 2000 Olly Betts

	* Some work on getting quartztest working.

Thu Dec 07 16:10:00 GMT 2000 Olly Betts

	* The library now builds, but "make check" still fails.

Thu Dec  7 15:39:19 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fixes to testsuite/index_utils.cc to not segfault.

Thu Dec  7 14:31:56 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fixes to api_db.cc so that it compiles.

Wed Dec  6 18:50:48 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add test for terms with spaces, newlines, zero bytes, or
	  backslashes.

	* Updates to TODO

Wed Dec 06 18:18:16 GMT 2000 Olly Betts

	* Woohoo!  Now builds with just --disable-indexer!
	  (still doesn't pass any tests).

Wed Dec 06 17:24:19 GMT 2000 Olly Betts

	* Minor fix.  Now builds with --disable-indexer
	  --disable-quartz-backend (but doesn't pass any tests).

Wed Dec 06 16:35:34 GMT 2000 Olly Betts

	* Fixed up lots of build errors.

Wed Dec 06 14:56:59 GMT 2000 Olly Betts

	* Begin the long job of replacing OmDocumentContents with
	  OmDocument.  Won't currently build - expect the tree to be broken
	  for a few days.  As usual, if you want a working build, use the
	  "snapshot_latest" tag.

Wed Dec  6 12:03:44 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Backed out yesterday's overwritten-handling stuff.

Wed Dec  6 11:36:55 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Increase sleep in tcpclient1 to 3 (did tcpmatch1 last time, duh!)

Tue Dec  5 17:13:38 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* QuartzDocument now has a QuartzTableManager pointer rather than
	  two QuartzTable pointers.
	
	* QuartzDatabase::do_get_document_internal() copes with Btree
	  overwritten conditions.
	
	* QuartzDocument methods cope with Btree overwritten conditions

	* New method QuartzTableManager::reopen_tables_because_overwritten()
	  for helping with the above.
	
	* New test in quartztest for testing overwritten problems from the
	  API rather than just internally to Quartz.
	
	* Fixed a typo in omsettings.h comment (quartz_dir used to refer to
	  a sleepycat database)

Tue Dec  5 16:53:46 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Update todo.

	* Fix undesirable assert in stats.h

Tue Dec  5 15:41:40 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

        * Replace OmMSet::docs_considered with
	  OmMSet::matches_{lower_bound,estimated,upper_bound}, giving more
	  useful information.

	* PostLists now have get_termfreq_{min,est,max}(), instead of
	  get_termfreq(), so the postlist tree can be used to calculate
	  the matches_* values for the mset.  Implemented for all the
	  postlist subclasses.

	  LeafPostList's still has a virtual get_termfreq() method,
	  and implements get_termfreq_* in terms of it, so database postlists
	  don't need to be modified.

	* Passing of MSets across network modified to pass the new
	  information.

	* PendingMSet uses the values from the mset to return the values
	  of get_termfreq_*().  This assumes that recalc_maxweight has been
	  called first, which is has been.

	* Muscat36 databases get_termfreq() methods fixed to use a
	  LeafPostList rather than a PostList.

	* Renamed test docs_considered1 to matches1, and add several
	  more cases to it.

Tue Dec 05 15:38:27 GMT 2000 Olly Betts

	* Added tests/testdata/apitest_punc.txt to distribution.

Tue Dec 05 15:07:26 GMT 2000 Olly Betts

	* Oops, failed to add new file `tests/testdata/apitest_punc.txt'
	  with last check-in.

Tue Dec 05 14:34:04 GMT 2000 Olly Betts

	* OmTermListIterator implemented for an OmDocument with terms stored
	  in a map rather than coming from a Document.

	* Fixes to remote protocol so solve problems with terms with
	  punctuation in (regression test punc_terms1).

Mon Dec  4 15:02:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Makefile tweak in docs/

Mon Dec 04 14:13:05 GMT 2000 Olly Betts

	* More OmDocument work.

Mon Dec  4 11:43:46 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Renamed OmMSet::mbound to docs_considered.

Mon Dec  4 10:11:11 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added some more std:: prefixes for STLport.

Fri Dec  1 17:45:01 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Increase the sleep after the server is started by tcpclient1 to 3
	  seconds so that the server is more likely to have started when
	  then test ran.  This seems to be what was causing the test to
	  randomly fail.  Really, we want a better solution to this (such as
	  the server picking a port and writing it out on stdout once it is
	  listening.)

Fri Dec  1 17:27:02 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Swapped the ports used by tcpclient1 and tcpmatch1 to see if the
	  random failures follow suit.

Fri Dec  1 17:21:07 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Another minor fix to work with STLport.

Fri Dec  1 17:01:02 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add std::'s and similar to fix compilation with STLport.

	* Fix bug in expander due to nth_element being called on the wrong
	  element.  This is the counterpoint of the bug fixed on Nov 24th
	  with the matcher.

Fri Dec  1 16:30:26 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Minor tweaks in error strings.

Fri Dec 01 12:57:59 GMT 2000 Olly Betts

	* Corrected erroneous documentation comment.

Thu Nov 30 18:50:16 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* OmSettings no longer throws exceptions internally (at the cost of
	  slightly more code duplication).

Thu Nov 30 18:05:39 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add a few std::'s to strings which had been missed.

Thu Nov 30 16:41:11 GMT 2000 Olly Betts

	* OmDocument::Internal now knows its OmDatabase.
 	    
Thu Nov 30 16:40:33 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add context to network errors thrown from OmSocketLineBuf.

Thu Nov 30 16:21:47 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added a quartz test for largish bitmaps.

	* Fixed the code so that the above test would pass.

Thu Nov 30 16:10:37 GMT 2000 Olly Betts

	* OmDocument::add_posting() pretty much done.

Thu Nov 30 15:51:46 GMT 2000 Olly Betts

	* More work on OmDocument::add_posting().

	* Added OmTermListIterator::positionlist_begin() and
	  OmTermListIterator::positionlist_end().

Thu Nov 30 14:16:28 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed a prototype bug introduced with the last commit.

Thu Nov 30 13:23:14 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Bcursor::find_key now more const-correct.

	* Bcursor_create now returns an AutoPtr.  The resultant changes
	  fixed a memory leak.
	
	* New exception: OmDatabaseModifiedError.  Thrown when an open
	  revision of a table is no longer valid due to multiple updates.

	* quartzoverwrite1 test re-enabled, and passes.

Thu Nov 30 13:23:27 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* nettest now uses quartz backend: should always run all tests now
	  (apart from tcpdead1, which doesn't work).

Wed Nov 29 19:46:22 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* In testsuite, report the context of Om exceptions as well as their
	  type and message.

Wed Nov 29 18:30:10 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add "remote_connect_timeout" parameter to be supplied when opening
	  a remote database, to specify a separate timeout for the connect
	  operation to that used once the connection has been opened.

	* Add setting of the context of errors thrown by tcpclient or
	  progclient, so that the node which failed can be determined.

Wed Nov 29 17:50:03 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Reworked Btree_base::read() a bit so that it's hopefully more
	  readable.
	
	* Hopefully fixed a bug when the bitmap approaches 1k.

	* Fix to catch problems re-opening databases after an apply in
	  Quartz.

Wed Nov 29 17:30:26 GMT 2000 Olly Betts

	* Added OmDocument::termlist_begin() and OmDocument::termlist_end()

Wed Nov 29 16:53:13 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Comment out quartzoverwrite1 test so that it doesn't cause problems
	  for other developers.

Wed Nov 29 16:27:19 GMT 2000 Olly Betts

	* docid now in Document class rather than subclasses.

Wed Nov 29 14:54:13 GMT 2000 Olly Betts

	* leafdocument.cc renamed to document.cc

	* Document class now has a pointer to the associated Database class
	  so we can open termlists, etc.

Wed Nov 29 14:03:43 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add quartztest to test for case when a database block gets
	  overwritten.  Currently, this fails because an exception doesn't
	  get thrown when it should.

Wed Nov 29 13:18:24 GMT 2000 Olly Betts

	* LeafDocument class renamed to Document.

Wed Nov 29 12:35:49 GMT 2000 Olly Betts

	* Added OmDocument::remove_posting(), OmDocument::remove_term(),
	  and OmDocument::clear_terms()

Wed Nov 29 12:31:22 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added another revision number in the middle of the base file,
	  before the bitmap.  Also now check that there isn't any extra
	  data at the end after we finish reading it.  Incremented the
	  database format.

Wed Nov 29 11:55:03 GMT 2000 Olly Betts

	* Added OmDocument::remove_key() and OmDocument::clear_keys()

Tue Nov 28 18:34:57 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Btree bitmap now merged with base - one object, one file.

Tue Nov 28 17:13:56 GMT 2000 Olly Betts

	* Added OmDocument::set_data()

Tue Nov 28 16:47:06 GMT 2000 Olly Betts

	* Started to alter OmDocument to be a general purpose document class
	  which includes the functionality currently in OmDocumentContents.

Tue Nov 28 15:08:38 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added OmSplitOnCharsNode, which does a subset of OmRegexSplitNode
	  but less slowly.

	* Modified RegexSplit node and regexcommon so that less copying
	  of strings is needed.

Tue Nov 28 13:42:41 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Moved the Btree's bitmap into a separate object.

Tue Nov 28 13:06:36 GMT 2000 Olly Betts

	* Eliminated OmDocumentParams.

	* Removed unnecessary mutex from OmDocument::Internal.

Mon Nov 27 18:45:27 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Implement get_position_list() on databases.  Untested.  Also needs
	  some work to make consistent with open_position_list() on posting
	  lists: see todo list.

Mon Nov 27 18:29:00 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Change #define LEVEL ... to #define GET_LEVEL ... in btree_util.h:
	  fixes problem reported by includetest

Mon Nov 27 18:20:42 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added a set of modifications to the todo.xml.  Also, add a
	  "release" field, recording the release that the work must be
	  performed by.

Mon Nov 27 18:08:35 GMT 2000 Olly Betts

	* A RefCntPtr now copes with being assigned to itself (used to
	  delete the underlying object if the reference count was 1).  Added
	  regression test (refcnt2).

	* Now overwrite pointer inside RefCntPtr before deleting the pointed
	  to object so there's no window where another thread can access the
	  pointer and get the just-deleted object.

Mon Nov 27 14:36:59 GMT 2000 Olly Betts

	* OmError class now optionally stores an errno value.

Mon Nov 27 13:04:18 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Quartztest builds its test databases in a subdirectory, which
	  is now in .cvsignore, so we shouldn't get cvs complaining about
	  so many unknown files any more.

Mon Nov 27 12:53:16 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Another TODO item.

Mon Nov 27 12:15:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added a couple of new items to the todo list.

Fri Nov 24 19:23:56 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Quartztests now deletes all old tables, so that database formats
	  don't cause problems.

Fri Nov 24 19:03:59 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added std:: prefix to lots of strings which didn't have it.
	  I've probably added some where they shouldn't be: there were rather
	  a lot of cases of this.

Fri Nov 24 18:27:06 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Major bug fix!  When removing elements, matcher was performing
	  nth_element() on the first element to be thrown away, rather than
	  the lowest element to keep.  This meant that, after throwing away
	  low scoring items, items.back() was a random item rather than the
	  lowest scoring item.  This caused the min weight for getting into
	  the mset to go up faster than it should have done, and generally
	  broke everything.

	  It will be interesting to compare evaluation measures before and
	  after this fix.

Fri Nov 24 15:34:17 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Declare this to be version 0.4.1

