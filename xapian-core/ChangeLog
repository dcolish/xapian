Tue Dec 12 18:33:12 GMT 2000 Olly Betts

	* OmMSet::get_docs() now takes sane parameters.

	* Various test programs updated to nearly work with new OmMSet
	  interface.

Tue Dec 12 17:18:33 GMT 2000 Olly Betts

	* Finished cleaning up OmMSet; updated TODO to reflect this.

Tue Dec 12 17:16:02 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix bug with sorting keys in btrees.

	* Various fixes to quartzdump.

Tue Dec 12 15:40:28 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Nettest compiles with new OmMSet interface.

Tue Dec 12 15:09:14 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed an endless loop in QuartzWritableDatabase::do_delete_document.

Tue Dec 12 15:07:39 GMT 2000 Olly Betts

	* OmMSetItem replaced by OmMSetIterator.

	* Added OmESet::empty().

	* Fixed == on OmESetIterator.

Tue Dec 12 14:16:57 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Renamed arguments to compare_keys()

Tue Dec 12 12:05:24 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added quartzdump utility to dump the contents of a quartz table.

Tue Dec 12 10:54:44 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added constructors and destructor to OmRSet.

Mon Dec 11 16:32:07 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Remove caching of average length in OmDatabaseInternal, was breaking
	  asking for the average length of a database which was being
	  modified.

Mon Dec 11 16:03:46 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* If no documents in database, don't divide by zero in
	  omdatabaseinternal.cc

	* If a document object doesn't come from the database, when iterating
	  through its termlist don't open postlists from the nonexistant
	  database; open them from the DocumentTerm objects in the document
	  instead.

	* Remove old unused and undefined method
	  OmDocument::Internal::add_posting()

Mon Dec 11 13:53:18 GMT 2000 Olly Betts

	* omenquire.h: Removed superfluous declaration of OmMSetCmp.

Mon Dec 11 13:38:12 GMT 2000 Olly Betts

	* Updated TODO list.

Mon Dec 11 13:24:45 GMT 2000 Olly Betts

	* OmRSet internals encapsulated.

Mon Dec 11 12:42:02 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* OmIndexerMessage::get_element and ...::operator[] now have
	  non-const versions.  Fixes const-warning in omstemmernode.cc.

Mon Dec 11 12:17:32 GMT 2000 Olly Betts

	* Better typedef-s for Om*Iterator::difference_type.

Sun Dec 10 17:51:41 GMT 2000 Olly Betts

	* Corrected various typedef-s for Om*Iterator.

Sun Dec 10 17:28:59 GMT 2000 Olly Betts

	* Updated TODO to reflect OmESet being cleaned up.

	* Term position argument to OmDocument::add_posting() is now
	  optional (as it was for OmDocumentContents).

Sun Dec 10 16:55:17 GMT 2000 Olly Betts

	* OmESetItem is dead - long live OmESetIterator!

	* net/socketclient.cc: fixed compiler warning.

	* net/socketserver.cc: fixed compiler warning.

Sun Dec 10 13:29:15 GMT 2000 Olly Betts

	* Started to encapsulate OmESet/OmESetItem interface.  Interface is
	  close, but currently implementation is exposed in omenquire.h.
	  
	* apitest wasn't running puncterms1 or spaceterms1 - fixed.
 
Sun Dec 10 11:34:39 GMT 2000 Olly Betts

	* om/autoptr.h -> autoptr.h in lots of places.

Fri Dec  8 17:20:04 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Updated indextest to not use AutoPtr<OmIndexer>

Fri Dec  8 17:14:09 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Oops - removed one too many #include "autoptr.h"

Fri Dec 08 16:50:42 GMT 2000 Olly Betts

	* Updated TODO.

Fri Dec  8 16:44:26 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* IndexerBuilder now returns OmIndexer objects instead of
	  AutoPtr<OmIndexer>.  OmIndexer's internals are reference
	  counted.
	
	* Moved autoptr.h from include/om to common/, since it's no
	  longer used in the API.

Fri Dec  8 16:22:48 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed omstemmer node bug and made debug slightly more verbose
	  in indextest.cc.

Fri Dec  8 16:13:36 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added a test for OmIndexerMessage to indextest

	* Added output operator for OmIndexerMessage

	* Fixed a bug introduced into omvectorsplit node

	* Changed couts in indextest.cc to touts.

Fri Dec 08 14:53:24 GMT 2000 Olly Betts

	* quartztest: removed OmDocumentTerm reference so that it'll
	  compile (tests fail though).

Fri Dec  8 14:42:46 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* OmIndexerMessage is now a class by itself, replacing OmIndexerData
	  and the typedef to AutoPtr<OmindexerData>.  It's now a copy-on-write
	  object.

	* The indexer stuff all changed.

Fri Dec 08 14:24:02 GMT 2000 Olly Betts

	* omindexdoc.{cc,h}: no longer used so removed.

	* Pushed OmDocumentTerm from API level into the internals of the
	  library.

	* Updated TODO.

Fri Dec 08 12:08:49 GMT 2000 Olly Betts

	* delve: if just given a database (or list of databases), report the
	  number of documents and average document length.

Thu Dec  7 20:39:24 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fix bug: Om*Iterators which were created over empty lists didn't
	  have null internals, causing them not to compare equal to end
	  iterators.

	* Added many asserts to iterator code.

Thu Dec  7 20:02:43 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Removed OmTermListIteratorMap - OmTermListIterator can now be
	  across either a map or an actual termlist.

	* Om*Iterator classes all now delete internals when reaching end,
	  freeing resources sooner and making the comparison operators much
	  simpler.

Thu Dec  7 18:33:03 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Updates to TODO

Thu Dec  7 18:32:39 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Implementation of write locks for Quartz

Thu Dec  7 18:28:55 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fix to backendmanager which doesn't return writable databases
	  unnecessarily (which breaks things when there are write locks)

Thu Dec  7 18:25:50 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added test for Quartz write locks

Thu Dec  7 17:56:19 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add OmDocument::set_data() method which takes a string, instead of
	  an OmData object.  This allows, implicitly, use of const char *'s
	  as well.

	* Further fixes to quartztest.  It now compiles (though I've not
	  tried linking it yet...)  :)

Thu Dec  7 17:49:50 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed omkeylistiterator return types.

Thu Dec  7 17:27:57 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Moved get_document() from OmWritableDatabase to OmDatabase.

	* Added -> operator to OmKeyListIterator.  Fixed return values
	  and constness of Om*Iterator::operator *() methods.

	* Some fixes to quartztest.cc, but not enough to get it compiling.

Thu Dec 07 16:21:28 GMT 2000 Olly Betts

	* Some work on getting quartztest working.

Thu Dec 07 16:10:00 GMT 2000 Olly Betts

	* The library now builds, but "make check" still fails.

Thu Dec  7 15:39:19 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fixes to testsuite/index_utils.cc to not segfault.

Thu Dec  7 14:31:56 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Fixes to api_db.cc so that it compiles.

Wed Dec  6 18:50:48 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add test for terms with spaces, newlines, zero bytes, or
	  backslashes.

	* Updates to TODO

Wed Dec 06 18:18:16 GMT 2000 Olly Betts

	* Woohoo!  Now builds with just --disable-indexer!
	  (still doesn't pass any tests).

Wed Dec 06 17:24:19 GMT 2000 Olly Betts

	* Minor fix.  Now builds with --disable-indexer
	  --disable-quartz-backend (but doesn't pass any tests).

Wed Dec 06 16:35:34 GMT 2000 Olly Betts

	* Fixed up lots of build errors.

Wed Dec 06 14:56:59 GMT 2000 Olly Betts

	* Begin the long job of replacing OmDocumentContents with
	  OmDocument.  Won't currently build - expect the tree to be broken
	  for a few days.  As usual, if you want a working build, use the
	  "snapshot_latest" tag.

Wed Dec  6 12:03:44 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Backed out yesterday's overwritten-handling stuff.

Wed Dec  6 11:36:55 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Increase sleep in tcpclient1 to 3 (did tcpmatch1 last time, duh!)

Tue Dec  5 17:13:38 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* QuartzDocument now has a QuartzTableManager pointer rather than
	  two QuartzTable pointers.
	
	* QuartzDatabase::do_get_document_internal() copes with Btree
	  overwritten conditions.
	
	* QuartzDocument methods cope with Btree overwritten conditions

	* New method QuartzTableManager::reopen_tables_because_overwritten()
	  for helping with the above.
	
	* New test in quartztest for testing overwritten problems from the
	  API rather than just internally to Quartz.
	
	* Fixed a typo in omsettings.h comment (quartz_dir used to refer to
	  a sleepycat database)

Tue Dec  5 16:53:46 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Update todo.

	* Fix undesirable assert in stats.h

Tue Dec  5 15:41:40 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

        * Replace OmMSet::docs_considered with
	  OmMSet::matches_{lower_bound,estimated,upper_bound}, giving more
	  useful information.

	* PostLists now have get_termfreq_{min,est,max}(), instead of
	  get_termfreq(), so the postlist tree can be used to calculate
	  the matches_* values for the mset.  Implemented for all the
	  postlist subclasses.

	  LeafPostList's still has a virtual get_termfreq() method,
	  and implements get_termfreq_* in terms of it, so database postlists
	  don't need to be modified.

	* Passing of MSets across network modified to pass the new
	  information.

	* PendingMSet uses the values from the mset to return the values
	  of get_termfreq_*().  This assumes that recalc_maxweight has been
	  called first, which is has been.

	* Muscat36 databases get_termfreq() methods fixed to use a
	  LeafPostList rather than a PostList.

	* Renamed test docs_considered1 to matches1, and add several
	  more cases to it.

Tue Dec 05 15:38:27 GMT 2000 Olly Betts

	* Added tests/testdata/apitest_punc.txt to distribution.

Tue Dec 05 15:07:26 GMT 2000 Olly Betts

	* Oops, failed to add new file `tests/testdata/apitest_punc.txt'
	  with last check-in.

Tue Dec 05 14:34:04 GMT 2000 Olly Betts

	* OmTermListIterator implemented for an OmDocument with terms stored
	  in a map rather than coming from a Document.

	* Fixes to remote protocol so solve problems with terms with
	  punctuation in (regression test punc_terms1).

Mon Dec  4 15:02:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Makefile tweak in docs/

Mon Dec 04 14:13:05 GMT 2000 Olly Betts

	* More OmDocument work.

Mon Dec  4 11:43:46 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Renamed OmMSet::mbound to docs_considered.

Mon Dec  4 10:11:11 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added some more std:: prefixes for STLport.

Fri Dec  1 17:45:01 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Increase the sleep after the server is started by tcpclient1 to 3
	  seconds so that the server is more likely to have started when
	  then test ran.  This seems to be what was causing the test to
	  randomly fail.  Really, we want a better solution to this (such as
	  the server picking a port and writing it out on stdout once it is
	  listening.)

Fri Dec  1 17:27:02 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Swapped the ports used by tcpclient1 and tcpmatch1 to see if the
	  random failures follow suit.

Fri Dec  1 17:21:07 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Another minor fix to work with STLport.

Fri Dec  1 17:01:02 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add std::'s and similar to fix compilation with STLport.

	* Fix bug in expander due to nth_element being called on the wrong
	  element.  This is the counterpoint of the bug fixed on Nov 24th
	  with the matcher.

Fri Dec  1 16:30:26 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Minor tweaks in error strings.

Fri Dec 01 12:57:59 GMT 2000 Olly Betts

	* Corrected erroneous documentation comment.

Thu Nov 30 18:50:16 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* OmSettings no longer throws exceptions internally (at the cost of
	  slightly more code duplication).

Thu Nov 30 18:05:39 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add a few std::'s to strings which had been missed.

Thu Nov 30 16:41:11 GMT 2000 Olly Betts

	* OmDocument::Internal now knows its OmDatabase.
 	    
Thu Nov 30 16:40:33 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add context to network errors thrown from OmSocketLineBuf.

Thu Nov 30 16:21:47 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added a quartz test for largish bitmaps.

	* Fixed the code so that the above test would pass.

Thu Nov 30 16:10:37 GMT 2000 Olly Betts

	* OmDocument::add_posting() pretty much done.

Thu Nov 30 15:51:46 GMT 2000 Olly Betts

	* More work on OmDocument::add_posting().

	* Added OmTermListIterator::positionlist_begin() and
	  OmTermListIterator::positionlist_end().

Thu Nov 30 14:16:28 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Fixed a prototype bug introduced with the last commit.

Thu Nov 30 13:23:14 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Bcursor::find_key now more const-correct.

	* Bcursor_create now returns an AutoPtr.  The resultant changes
	  fixed a memory leak.
	
	* New exception: OmDatabaseModifiedError.  Thrown when an open
	  revision of a table is no longer valid due to multiple updates.

	* quartzoverwrite1 test re-enabled, and passes.

Thu Nov 30 13:23:27 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* nettest now uses quartz backend: should always run all tests now
	  (apart from tcpdead1, which doesn't work).

Wed Nov 29 19:46:22 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* In testsuite, report the context of Om exceptions as well as their
	  type and message.

Wed Nov 29 18:30:10 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add "remote_connect_timeout" parameter to be supplied when opening
	  a remote database, to specify a separate timeout for the connect
	  operation to that used once the connection has been opened.

	* Add setting of the context of errors thrown by tcpclient or
	  progclient, so that the node which failed can be determined.

Wed Nov 29 17:50:03 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Reworked Btree_base::read() a bit so that it's hopefully more
	  readable.
	
	* Hopefully fixed a bug when the bitmap approaches 1k.

	* Fix to catch problems re-opening databases after an apply in
	  Quartz.

Wed Nov 29 17:30:26 GMT 2000 Olly Betts

	* Added OmDocument::termlist_begin() and OmDocument::termlist_end()

Wed Nov 29 16:53:13 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Comment out quartzoverwrite1 test so that it doesn't cause problems
	  for other developers.

Wed Nov 29 16:27:19 GMT 2000 Olly Betts

	* docid now in Document class rather than subclasses.

Wed Nov 29 14:54:13 GMT 2000 Olly Betts

	* leafdocument.cc renamed to document.cc

	* Document class now has a pointer to the associated Database class
	  so we can open termlists, etc.

Wed Nov 29 14:03:43 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Add quartztest to test for case when a database block gets
	  overwritten.  Currently, this fails because an exception doesn't
	  get thrown when it should.

Wed Nov 29 13:18:24 GMT 2000 Olly Betts

	* LeafDocument class renamed to Document.

Wed Nov 29 12:35:49 GMT 2000 Olly Betts

	* Added OmDocument::remove_posting(), OmDocument::remove_term(),
	  and OmDocument::clear_terms()

Wed Nov 29 12:31:22 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added another revision number in the middle of the base file,
	  before the bitmap.  Also now check that there isn't any extra
	  data at the end after we finish reading it.  Incremented the
	  database format.

Wed Nov 29 11:55:03 GMT 2000 Olly Betts

	* Added OmDocument::remove_key() and OmDocument::clear_keys()

Tue Nov 28 18:34:57 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Btree bitmap now merged with base - one object, one file.

Tue Nov 28 17:13:56 GMT 2000 Olly Betts

	* Added OmDocument::set_data()

Tue Nov 28 16:47:06 GMT 2000 Olly Betts

	* Started to alter OmDocument to be a general purpose document class
	  which includes the functionality currently in OmDocumentContents.

Tue Nov 28 15:08:38 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Added OmSplitOnCharsNode, which does a subset of OmRegexSplitNode
	  but less slowly.

	* Modified RegexSplit node and regexcommon so that less copying
	  of strings is needed.

Tue Nov 28 13:42:41 GMT 2000 Chris Emerson <chris.emerson@open.muscat.com>

	* Moved the Btree's bitmap into a separate object.

Tue Nov 28 13:06:36 GMT 2000 Olly Betts

	* Eliminated OmDocumentParams.

	* Removed unnecessary mutex from OmDocument::Internal.

Mon Nov 27 18:45:27 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Implement get_position_list() on databases.  Untested.  Also needs
	  some work to make consistent with open_position_list() on posting
	  lists: see todo list.

Mon Nov 27 18:29:00 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Change #define LEVEL ... to #define GET_LEVEL ... in btree_util.h:
	  fixes problem reported by includetest

Mon Nov 27 18:20:42 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added a set of modifications to the todo.xml.  Also, add a
	  "release" field, recording the release that the work must be
	  performed by.

Mon Nov 27 18:08:35 GMT 2000 Olly Betts

	* A RefCntPtr now copes with being assigned to itself (used to
	  delete the underlying object if the reference count was 1).  Added
	  regression test (refcnt2).

	* Now overwrite pointer inside RefCntPtr before deleting the pointed
	  to object so there's no window where another thread can access the
	  pointer and get the just-deleted object.

Mon Nov 27 14:36:59 GMT 2000 Olly Betts

	* OmError class now optionally stores an errno value.

Mon Nov 27 13:04:18 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Quartztest builds its test databases in a subdirectory, which
	  is now in .cvsignore, so we shouldn't get cvs complaining about
	  so many unknown files any more.

Mon Nov 27 12:53:16 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Another TODO item.

Mon Nov 27 12:15:53 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added a couple of new items to the todo list.

Fri Nov 24 19:23:56 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Quartztests now deletes all old tables, so that database formats
	  don't cause problems.

Fri Nov 24 19:03:59 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Added std:: prefix to lots of strings which didn't have it.
	  I've probably added some where they shouldn't be: there were rather
	  a lot of cases of this.

Fri Nov 24 18:27:06 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Major bug fix!  When removing elements, matcher was performing
	  nth_element() on the first element to be thrown away, rather than
	  the lowest element to keep.  This meant that, after throwing away
	  low scoring items, items.back() was a random item rather than the
	  lowest scoring item.  This caused the min weight for getting into
	  the mset to go up faster than it should have done, and generally
	  broke everything.

	  It will be interesting to compare evaluation measures before and
	  after this fix.

Fri Nov 24 15:34:17 GMT 2000  Richard Boulton <richard.boulton@open.muscat.com>

	* Declare this to be version 0.4.1

