#! /bin/sh
# @configure_input@
#
# Copyright 1999,2000,2001 BrightStation PLC
# Copyright 2002,2003,2004,2005 Olly Betts
#
# This program is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307
# USA

prefix="@prefix@"
exec_prefix="@exec_prefix@"
libdir="@libdir@"
includedir="@includedir@"

usage()
{
    cat <<EOF
Usage: xapian-config [OPTION]...

Options:
  --libs	print library linking information
  --ltlibs	print library linking information for linking with GNU libtool
  --cxxflags	print preprocessor and compiler flags
  --swigflags	print preprocessor flags for SWIG
  --help	display this help and exit successfully
  --version	output version information
EOF

    exit $1
}

if test 0 = "$#"; then
    usage 1
fi

builddir="`echo $0|sed 's![^/]*$!!'`"
xo_lib_xapian=no

while test 0 != "$#"; do
    case "$1" in
    --version)
	echo "xapian @VERSION@"
	exit 0
	;;

    --from-xo-lib-xapian)
	# Top Secret option which allows us to give a more helpful error
	# message if we're asked to link with an uninstalled libxapian
	# and libtool isn't in use.
	xo_lib_xapian=yes
	;;

    --help)
	usage 0
	;;

    --cxxflags)
	inc=
	# check if this is an uninstalled xapian-config
	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    inc=
	    # version.h is generated by configure, so we need builddir too
	    test "@abs_srcdir@" != "@abs_builddir@" && inc="-I@abs_builddir@/include "
	    inc="$inc-I@abs_srcdir@/include -I@abs_srcdir@/extra"
	else
	    # Adding -I/usr/include to CXXFLAGS causes problems with certain
	    # versions of GCC on some platforms where GCC generates "fixed"
	    # versions of vendor supplied include headers at install time.
	    # Normally these are used instead of those in /usr/include, but if
	    # you explicitly pass -I/usr/include you get the non-fixed
	    # versions.  More recent GCC versions simply ignore -I/usr/include
	    # but we want to support older versions too.
	    case "$includedir" in
	    /usr/include|/usr/include/c++) ;;
	    *) inc="-I$includedir" ;;
	    esac
	fi
	cxxflags=
	test -n "@ANSI_CXXFLAGS@" && cxxflags="@ANSI_CXXFLAGS@ "
	test -n "@STLPORT_CXXFLAGS@" && cxxflags="${cxxflags}@STLPORT_CXXFLAGS@ "
	echo "${cxxflags}$inc"
	;;

    --swigflags)
	inc=
	# check if this is an uninstalled xapian-config
	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    inc=
	    # version.h is generated by configure, so we need builddir too
	    test "@abs_srcdir@" != "@abs_builddir@" && inc="-I@abs_builddir@/include "
	    inc="$inc-I@abs_srcdir@/include -I@abs_srcdir@/extra"
	else
	    inc="-I$includedir"
	fi
	echo "$inc"
	;;

    --libs)
	# check if this is an uninstalled xapian-config
	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    if test no = "$xo_lib_xapian" ; then
		echo "$0: Use libtool and 'xapian-config --ltlibs'" 1>&2
	    else
	        configure_ac='configure.in (or configure.ac)'
		# If ac_top_srcdir isn't passed to us, we just end up looking
		# in the current directory, which is a sensible fallback.
		if test -r "${ac_top_srcdir}configure.ac" ; then
		    configure_ac=configure.ac
		elif test -r "${ac_top_srcdir}configure.in" ; then
		    configure_ac=configure.in
		fi
		echo "$0: Add AC_PROG_LIBTOOL to your $configure_ac" 1>&2
	    fi
	    echo "to link with an uninstalled libxapian." 1>&2
	    exit 1
	fi
	F=
	test -n "@ldflags@" && F="@ldflags@ "
	L=
	test /usr/lib != "$libdir" && L="-L$libdir "
	D=
	eval `grep ^dependency_libs= "$libdir/libxapian.la"`
	test -n "$dependency_libs" && D=" $dependency_libs"
	echo "$F$L-lxapian$D"
	;;

    --ltlibs)
	F=
	test -n "@ldflags@" && F="@ldflags@ "
	# check if this is an uninstalled xapian-config
	if test -n "$builddir" -a -f "${builddir}Makefile" ; then
	    # don't check if libxapian.la exists yet - it won't unless
	    # the xapian-core tree has been built!
	    echo "$F${builddir}libxapian.la"
	    exit 0
	fi

	if test -f "$libdir/libxapian.la"; then
	    echo "$F$libdir/libxapian.la"
	    exit 0
	fi

	echo "$0: Can't find libxapian.la to link against." 1>&2
	exit 1
	;;

    *)
	usage 1 1>&2
	exit 1
	;;
    esac
    shift
done
exit 0
