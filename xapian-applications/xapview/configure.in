dnl Process this file with autoconf to produce a configure script.
AC_INIT(xapview.cpp)
AM_INIT_AUTOMAKE(xapview, 0.1-cvs)
AM_CONFIG_HEADER(config.h)

dnl Add parameters for aclocal
dnl (This must come after AM_INIT_AUTOMAKE, since it modifies ACLOCAL)
ACLOCAL="$ACLOCAL $ACLOCAL_FLAGS"

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CXX

dnl Use libtool to manage our libraries
AC_PROG_LIBTOOL

dnl Check for libxapian
OM_PATH_XAPIAN(, AC_MSG_ERROR([Can't find Xapian library]))

dnl Checks for gtk / glib / glade
build_gui=yes
AM_PATH_GTK(1.2.0, , build_gui=no)
AM_PATH_GLIB(1.2.0, , build_gui=no)
AM_PATH_LIBGLADE(, build_gui=no)
AM_CONDITIONAL(BUILD_GUI, test yes = "$build_gui")

AC_CHECK_HEADERS([getopt.h],, AC_MSG_ERROR([can't build dbtool without getopt]))
dnl Check for getopt_long -- FreeBSD has a gnugetopt library
AC_CHECK_FUNCS([getopt_long],,
  AC_CHECK_LIB([gnugetopt],[getopt_long],[AC_DEFINE([HAVE_GETOPT_LONG])]))

dnl ******************************
dnl * Set special compiler flags *
dnl ******************************

dnl extra flags for building with gcc
if test yes = "$GCC"; then
  AM_CFLAGS="$AM_CFLAGS -Wall -Wunused -Wno-long-long"
  AM_CXXFLAGS="$AM_CXXFLAGS -Wall -Wunused -Wno-long-long -fno-gnu-keywords"
fi

dnl modify flags for building with stlport
if test yes = "$use_stlport"; then
  dnl STLport doesn't work with -ansi (at least, at version 4.0)
  if test yes = "$GCC"; then
    AM_CXXFLAGS="-nostdinc++ $AM_CXXFLAGS"
  fi
  AM_CXXFLAGS="$STLPORT_INCLUDE $AM_CXXFLAGS"
  LIBS="$STLPORT_LIBS $LIBS"
fi

dnl **************************
dnl * Build the output files *
dnl **************************

AC_OUTPUT(Makefile)
