<html>
$set{thousand,$.}$set{decimal,.}$setmap{BN,,Any Country,uk,England,fr,France}

${These take 2 or 3 parameters, the first being the form variable name
the second being the values which may be a list.
If there is no 3rd parameter then for each value (if a list) the entire
definition is written out again, if there is a third (or 4th) value then the list is
first joined with this value}
$def{querystring,$if{$3,$list{$map{$2,$url{$_}},$1=,,$3,$4},$list{$map{$2,$1=$url{$_}},&}}}
$def{ifquerystring,$if{$2,$querystring{$1,$2,$3,$4}&}}
$def{hiddenvar,$if{$3,$list{$map{$2,$html{$_}},<INPUT TYPE=hidden NAME=$1 VALUE=",,$3,$4">},$list{$map{$2,<INPUT TYPE=hidden NAME=$1 VALUE="$html{$_}">},}}}
$def{ifhiddenvar,$if{$2,$hiddenvar{$1,$2,$3,$4}}}

${make a note of the orignal relevant set for pop-out un-collapse links}
$def{allrelevants,$relevants}

${searchurl must end in & or ? (if no cgi parms)
It returns a url suitable for appending to which when followerd
will repeat the most similar search possible }
$def{searchurl,$html{$or{$env{SCRIPT_NAME},omega}}?$ifquerystring{DB,$dbname}$ifquerystring{FMT,$fmt}$ifquerystring{P,$queryterms,.,.}$ifquerystring{HITSPERPAGE,$hitsperpage}$ifquerystring{THRESHOLD,$cgi{THRESHOLD}}$ifquerystring{R,$relevants}}

$def{expandurl,$searchurl{}B=$url{Z$value{$cgi{COLLAPSE}}}}

$def{collapse_link,$if{$ne{$collapsed,0},<br>$collapsed <a href="$expandurl" target="_bank">$if{$2,$2,$value{$cgi{COLLAPSE}}}</a>}}

$def{showhitrel,<IMG SRC="/icons/omega/score-$div{$percentage,10}.png"
ALT="$percentage%" HEIGHT=16 WIDTH=32><br></TD>
<TD VALIGN=top><TABLE BORDER=0 CELLPADDING=1><TR><TD BGCOLOR="#ccffcc">
<INPUT TYPE=checkbox NAME=R VALUE=$id$if{$relevant, CHECKED}></TD></TR></TABLE>}

$def{hitcaption,$or{$field{caption},$field{title},$field{url},Untitled}}
$def{hitsample,$if{$field{sample},$highlight{$field{sample},$terms}...}}
$def{hiturl,$field{url}}
$def{hitmatching,<i>$list{$map{$terms,$html{$prettyterm{$_}}},$. ,</i> and <i>}</i>}
$def{grouplabel,$value{$cgi{COLLAPSE}}}

$def{showgroupdesc,<a href="$expandurl" target="_blank">More <b>$grouplabel</b> results</a>}

$def{showhitdesc,<B><small>$html{$date{$field{modtime},%Y-%m-%d %H:%M}}</small>
<A HREF="$field{url}">$html{$hitcaption}</A></B><BR>
<small>$hitsample</small><br>
<A HREF="$hiturl">$html{$hiturl}</A><br>
<small>
$if{$field{language},Language: <b>$html{$field{language}}</b>}
$if{$field{size},Size: <b>$html{$filesize{$field{size}}}</b>}
$if{$field{language}$field{size},<br>}
$percentage% relevant$. matching: $hitmatching
</small>${for lynx:}<P>}

$def{grouped,$and{$ne{$collapsed,0},$opt{groupcollapse}}}

$def{showhit,<TR><TD VALIGN=top>$if{$grouped,</td><td>&nbsp;,$showhitrel}</TD><TD>$if{$grouped,$showgroupdesc,$showhitdesc}</TD></TR>}

${
$def{PREV,
$if{$ne{$topdoc,0},<INPUT TYPE=image NAME="&lt;" ALT="&lt;"
SRC="/icons/omega/prev.png" BORDER=0 HEIGHT=30 WIDTH=30>,
<IMG ALT="" SRC="/icons/omega/prevoff.png" HEIGHT=30 WIDTH=30>}
}

$def{NEXT,
$if{$ne{$last,$msize},<INPUT TYPE=image NAME="&gt;" ALT="&gt;"
SRC="/icons/omega/next.png" BORDER=0 HEIGHT=30 WIDTH=30>,
<IMG ALT="" SRC="/icons/omega/nextoff.png" HEIGHT=30 WIDTH=30>}
}

$def{P,<INPUT TYPE=image NAME="$1" VALUE="$1" SRC="/icons/omega/page-$2.png" BORDER=0$opt{a} ALT="$1">}
$def{PAGE,$if{$gt{$1,9},$if{$gt{$1,99},$P{$1,$div{$1,100}}}$P{$1,$mod{$div{$1,10},10}}}$P{$1,$mod{$1,10}}}

$def{S,<IMG SRC="/icons/omega/page-$2s.png"$opt{a} ALT=$1>}
$def{SPAGE,$if{$gt{$1,9},$if{$gt{$1,99},$S{$1,$div{$1,100}}}$S{$1,$mod{$div{$1,10},10}}}$S{$1,$mod{$1,10}}}
}

$def{PREV,$if{$ne{$topdoc,0},<INPUT TYPE=submit NAME="&lt;" VALUE="Previous">}}

$def{PAGE,<INPUT TYPE=submit NAME="[" VALUE="$1">}

$def{SPAGE,<INPUT TYPE=submit NAME="[" VALUE="$1" DISABLED=disabled>}

$def{NEXT,$if{$ne{$last,$msize},<INPUT TYPE=submit NAME="&gt;" VALUE="Next">}}

$set{topterms,$or{$ne{$msize,0},$query}}

$set{groupcollapse,$if{$cgi{GROUP},1}}
<head>
<title>$if{$query,Omega search results for `$html{$query}',New Omega Search}</title>
$if{$opt{topterms},$include{toptermsjs}}
</head>
<body bgcolor="#ffffff">
$querydescription
<FORM NAME=P METHOD=GET 
ACTION="$html{$or{$env{SCRIPT_NAME},omega}}" TARGET="_top">
<center>
<INPUT NAME=P VALUE="$html{$query}" SIZE=65>
<INPUT TYPE=SUBMIT VALUE="Search" BORDER=0>
<hr>
$if{,$include{anyalldropbox},$include{anyallradio}}
$if{$opt{topterms},
 <hr>
 <table><tr><td bgcolor="#ccffcc">
 $map{$topterms,<span style="white-space:nowrap"><INPUT TYPE=checkbox NAME=X VALUE="$prettyterm{$_}" onClick="C(this)">$prettyterm{$_}</span> }
 <BR><NOSCRIPT><INPUT TYPE=hidden NAME=ADD VALUE=1></NOSCRIPT>
 </td></tr></table>
 <hr>
}
$if{$eq{$msize,0},
$if{$query,$or{$html{$error},No documents match your query},
<hr>Searching $nice{$dbsize} documents
},
$if{$not{$msizeexact},
 $nice{$add{$topdoc,1}}-$nice{$last} of about $nice{$msize} matches,
 $if{$and{$eq{$last,$msize},$eq{$topdoc,0}},
  All $nice{$msize} matches,
  $nice{$add{$topdoc,1}}$if{$ne{$add{$topdoc,1},$msize},-$nice{$last}} of exactly $nice{$msize} matches}
}
<hr>
</center>
$list{$map{$queryterms,$list{$html{$unstem{$_}},<b>,</b>/<b>,</b>}:&nbsp;$nice{$freq{$_}}},Term frequencies: ,$. ,}
<br><small>Search took $time seconds</small>
<table>
$hitlist{$showhit}
</table>
<br><center>

${suppress next, prev, and page links if there's only one page}
$if{$ne{$lastpage,1},
$set{a,$if{$opt{pagelink_height}, HEIGHT=$opt{pagelink_height}}$if{$opt{pagelink_width}, WIDTH=$opt{pagelink_width}}}

${1-W ... X-(this)-Y ...}
$set{w,$min{3,$add{$thispage,-1}}}
$set{x,$max{$add{$opt{w},1},$add{$thispage,-3}}}
$set{y,$min{$lastpage,$add{$thispage,8}}}
$PREV
$map{$range{1,$opt{w}},$PAGE{$_}}
$if{$ne{$add{$opt{w},1},$opt{x}},...}
$map{$range{$opt{x},$add{$thispage,-1}},$PAGE{$_}}
$SPAGE{$thispage}
$map{$range{$add{$thispage,1},$opt{y}},$PAGE{$_}}
$if{$ne{$opt{y},$lastpage},...}
$NEXT
}
</center><br>
}

$ifhiddenvar{DB,$dbname}
$hiddenvar{xDB,$dbname}
$hiddenvar{xP,$queryterms,.,.}
$hiddenvar{xB,$cgi{B}}
$hiddenvar{xFILTERS,$filters}
$if{$ne{$topdoc,0},$hiddenvar{TOPDOC,topdoc>}}
$if{$ne{$hitsperpage,10},$hiddenvar{HITSPERPAGE,$hitsperpage}}
$ifhiddenvar{FMT,$fmt}
$ifhiddenvar{COLLAPSE,$cgi{COLLAPSE}}
$ifhiddenvar{THRESHOLD,$cgi{THRESHOLD}}
$ifhiddenvar{B,$cgi{B}}
$hiddenvar{R,$relevants,.}
$ifhiddenvar{GROUP,$cgi{GROUP}}
</FORM>
<hr><div align=right><i><small><a href="http://www.xapian.org/">$html{$version}</a></small></i></div>
</body>
</html>
