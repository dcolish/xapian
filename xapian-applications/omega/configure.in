dnl Process this file with autoconf to produce a configure script.
AC_INIT(omega.cc)
AM_INIT_AUTOMAKE(omega, 0.4.1-cvs)
AM_CONFIG_HEADER(config.h)

dnl Add parameters for aclocal
dnl (This must come after AM_INIT_AUTOMAKE, since it modifies ACLOCAL)
ACLOCAL="$ACLOCAL $ACLOCAL_FLAGS"

dnl Checks for programs.
AC_PROG_CC
AC_PROG_CXX
AC_PROG_YACC

dnl Use libtool to manage our libraries
AM_PROG_LIBTOOL

dnl Check for libxapian
OM_PATH_XAPIAN(, AC_MSG_ERROR([Can't find Xapian library]))

dnl Check for libxml or libxml2.  We do this by looking for xml-config.
AC_PATH_PROG(XML_CONFIG_PATH, xml2-config)
if test -n "$XML_CONFIG_PATH" ; then
  HAVE_LIBXML2=yes
  AC_DEFINE(HAVE_LIBXML2,, [ Define if libxml2 is available.])
else
  HAVE_LIBXML2=no
  AC_PATH_PROG(XML_CONFIG_PATH, xml-config)
fi
if test -n "$XML_CONFIG_PATH" ; then
  AC_DEFINE(HAVE_LIBXML,, [ Define if libxml or libxml2 is available.])
fi
AM_CONDITIONAL(HAVE_LIBXML2, test yes = "$HAVE_LIBXML2")

if test -n "$XML_CONFIG_PATH"
then
    AC_MSG_CHECKING([libxml flags])
    LIBXML_CFLAGS=`$XML_CONFIG_PATH --cflags`
    LIBXML_LIBS=`$XML_CONFIG_PATH --libs`

    AC_LANG_SAVE
    AC_LANG_C
    SAVE_CFLAGS="$CFLAGS"
    CFLAGS="$CFLAGS $LIBXML_CFLAGS"
    AC_TRY_COMPILE([
#include <parser.h>
#include <valid.h>
], [ xmlValidCtxt ctxt;
     xmlDocPtr doc;
     xmlValidateDocument(&ctxt, doc);
     ], [have_libxml_valid=yes], [have_libxml_valid=no])
    CFLAGS="$SAVE_CFLAGS"
    AC_LANG_RESTORE
    AC_MSG_RESULT("$LIBXML_CFLAGS")
fi
AC_SUBST(LIBXML_CFLAGS)
AC_SUBST(LIBXML_LIBS)
if test yes = "$have_libxml_valid"; then
AC_DEFINE(HAVE_LIBXML_VALID,,
	  [ Define if libxml has validation available ])
else
AC_MSG_WARN(libxml doesn't have xmlValidateDocument: disabling validation.)
fi

dnl ******************************
dnl * Set special compiler flags *
dnl ******************************

dnl extra flags for building with gcc
if test yes = "$GCC"; then
  AM_CFLAGS="$AM_CFLAGS -Wall -Wunused -Wno-long-long"
  AM_CXXFLAGS="$AM_CXXFLAGS -Wall -Wunused -Wno-long-long -fno-gnu-keywords"
fi

dnl **************************
dnl * Build the output files *
dnl **************************

AC_OUTPUT(Makefile)
