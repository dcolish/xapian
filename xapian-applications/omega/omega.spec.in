# RedHat-style .spec file for Xapian
# Generated by "configure"

Name: @PACKAGE@
Version: @VERSION@
Release: 2
Requires: xapian-core
BuildPrereq: xapian-core, xapian-core-devel
License: GPL
Group: Applications/Internet
URL: http://www.xapian.org/
Summary: @PACKAGE@ is a CGI application which uses the Xapian search library to search a collection of documents

Source0: http://www.xapian.org/download/distributions/%{name}-%{version}.tar.gz

# Where are we going to build the install set to?
BuildRoot: %{_tmppath}/%{name}-root

%description
@PACKAGE@ is a CGI application which uses the Xapian search library to
search a collection of documents

%package images
Group: Applications/Internet
Summary: Images optionally used by the omega templates
Requires: omega
Prefix: /var/www/html/images

%description images
The omega templates can make use of images as form submit elements when
displaying results, instead of using submit buttons.  This package contaings
such images.  By default it installs in /var/www/html/images/omega as the
templates will use /images/omega as the URI prefix, but as this package
is RELOCATABLE you could install it some where else.  The relocate prefix
is /var/www/html/images so you should have little trouble installing it
where you like, or even LEAVING IT OUT ALTOGETHER, or making sneaky use
if rpm2cpio to STEAL THE CONTENTS

%prep
%setup -q -n %{name}-%{version}

%build

test -f ./configure || ./buildall
./configure
make -j4

%install
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT

make install-strip prefix=$RPM_BUILD_ROOT%{_prefix}
mkdir -p $RPM_BUILD_ROOT/var/www/cgi-bin
mv $RPM_BUILD_ROOT/usr/bin/omega $RPM_BUILD_ROOT/var/www/cgi-bin
mkdir -p $RPM_BUILD_ROOT%{_prefix}/share/doc/%{name}

# docs
cp COPYING INSTALL README NEWS TODO docs/* $RPM_BUILD_ROOT%{_prefix}/share/doc/%{name}/
mkdir -p $RPM_BUILD_ROOT/etc
cp omega.conf $RPM_BUILD_ROOT/etc

# default templates
mkdir -p $RPM_BUILD_ROOT/var/lib/omega/templates
cp templates/* $RPM_BUILD_ROOT/var/lib/omega/templates/
# data dir
mkdir -p $RPM_BUILD_ROOT/var/lib/omega/data

mkdir -p $RPM_BUILD_ROOT/var/www/html/images/omega
cp images/* $RPM_BUILD_ROOT/var/www/html/images/omega/

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
/usr/bin/*
/var/lib/omega/
%docdir /usr/share/doc/%{name}
/usr/share/doc/%{name}
%config /etc/omega.conf

%files images
/var/www/html/images/omega

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%changelog
* Wed May 14 2002  Sam Liddicott <sam@ananova.com>
  First cut based on xapian spec file
