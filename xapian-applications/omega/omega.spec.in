# RedHat-style .spec file for Xapian
# @configure_input@

Name: @PACKAGE@
Version: @VERSION@
Release: 1
Requires: xapian-core
BuildPrereq: xapian-core, xapian-core-devel
License: GPL
Group: Applications/Internet
URL: http://www.xapian.org/
Summary: @PACKAGE@ is a CGI application which uses the Xapian search library to index and search a collection of documents

Source0: http://www.xapian.org/download/distributions/%{name}-%{version}.tar.gz

# Where are we going to build the install set to?
BuildRoot: %{_tmppath}/%{name}-root

%description
@PACKAGE@ is a CGI application which uses the Xapian search library to
index and search a collection of documents

%prep
%setup -q -n %{name}-%{version}

%build

test -f ./configure || ./bootstrap
./configure
make

%install
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT
mkdir -p $RPM_BUILD_ROOT

make install-strip prefix=$RPM_BUILD_ROOT%{_prefix}
mkdir -p $RPM_BUILD_ROOT/var/www/cgi-bin
cp $RPM_BUILD_ROOT/usr/lib/omega/bin/omega $RPM_BUILD_ROOT/var/www/cgi-bin
mkdir -p $RPM_BUILD_ROOT%{_prefix}/share/doc/%{name}

# docs
cp COPYING INSTALL README NEWS TODO docs/* $RPM_BUILD_ROOT%{_prefix}/share/doc/%{name}/
mkdir -p $RPM_BUILD_ROOT/etc
cp omega.conf $RPM_BUILD_ROOT/etc

# default templates
mkdir -p $RPM_BUILD_ROOT/var/lib/omega/templates
cp templates/* $RPM_BUILD_ROOT/var/lib/omega/templates/
# data dir
mkdir -p $RPM_BUILD_ROOT/var/lib/omega/data

mkdir -p $RPM_BUILD_ROOT/var/www/icons/omega
cp images/* $RPM_BUILD_ROOT/var/www/icons/omega/

%clean
[ "$RPM_BUILD_ROOT" != "/" ] && rm -rf $RPM_BUILD_ROOT

%files
%defattr(-,root,root)
/usr/bin/*
/var/www/cgi-bin/*
/var/lib/omega/
%docdir /usr/share/doc/%{name}
/usr/share/doc/%{name}
%config /etc/omega.conf
/var/www/icons/omega

%post -p /sbin/ldconfig

%postun -p /sbin/ldconfig

%changelog
* Wed May 14 2002  Sam Liddicott <sam@ananova.com>
  First cut based on xapian spec file
